<script>
const text = document.getElementById("text");
const carry = document.getElementById("carry");
const cake = document.getElementById("cakeSolo");
const age18 = document.getElementById("age18");
const card = document.getElementById("card");
const music = document.getElementById("music");

let stage = -1;        // -1 = intro yazÄ±larÄ±
let lock = true;
let started = false;

/* ===== INTRO ===== */
const intro = [
  "Koca AyÄ±dan Sana Bir SÃ¼rpriz Var ğŸ",
  "SÃ¼rprizi Ã¶ÄŸrenmek istiyorsan",
  "ekrana dokun"
];

intro.forEach((l, i) => {
  setTimeout(() => {
    const d = document.createElement("div");
    d.className = "paper";
    d.innerHTML = l;
    text.appendChild(d);

    // SADECE â€œekrana dokunâ€ geldikten sonra ilerlenebilir
    if (i === intro.length - 1) {
      stage = 0;
      lock = false;
    }
  }, 1200 * i);
});

/* ===== CLICK ===== */
document.body.addEventListener("click", () => {
  if (lock) return;

  if (!started) {
    started = true;
    music.play().catch(()=>{});
  }

  /* 0ï¸âƒ£ INTRO â†’ PASTA */
  if (stage === 0) {
    stage = 1;
    lock = true;

    document.body.className = "cake-bg";
    text.innerHTML = "";
    carry.style.display = "flex";

    setTimeout(() => {
      carry.style.display = "none";
      cake.style.display = "block";
      text.innerHTML = "PastayÄ± Ã¼flemeden Ã¶nce dilek tut";
      setTimeout(() => count(8), 1200);
    }, 3600);
  }

  /* 3ï¸âƒ£ ÃœFLEME */
  else if (stage === 3) {
    stage = 4;
    lock = true;

    // pasta sÃ¶ner
    age18.style.opacity = "0.2";
    cake.style.filter = "grayscale(100%)";

    // 1.5 sn sonra kedi gelsin
    setTimeout(() => {
      carry.style.display = "flex";
    }, 1500);

    // 3 sn sonra kedi pastayÄ± alÄ±p gitsin
    setTimeout(() => {
      carry.style.display = "none";
      cake.style.display = "none";
      text.innerHTML = "";
    }, 3000);

    // 4 sn sonra mektup
    setTimeout(() => {
      document.body.style.background =
        "linear-gradient(135deg,#ffd1dc,#ffb7c5,#ffe6ee)";
      card.style.display = "block";
      stage = 6;
      lock = false;
    }, 4000);
  }

  /* 6ï¸âƒ£ MEKTUP â†’ FINAL */
  else if (stage === 6) {
    stage = 7;
    lock = true;
    card.style.display = "none";
    final();
  }
});

/* ===== COUNTDOWN ===== */
function count(n) {
  stage = 2;
  text.innerHTML =
    "PastayÄ± Ã¼flemeden Ã¶nce dilek tut<br><span class='count'>" + n + "</span>";

  if (n > 1) {
    setTimeout(() => count(n - 1), 1200);
  } else {
    setTimeout(() => {
      text.innerHTML = "PastayÄ± Ã¼flemek iÃ§in ekrana dokun";
      stage = 3;
      lock = false;
    }, 1200);
  }
}

/* ===== FINAL ===== */
function final() {
  const lines = [
    "<img src='biz.jpg' style='width:240px;border-radius:18px;margin-bottom:12px;'>",
    "DoÄŸum GÃ¼nÃ¼n Kutlu Olsun AÅŸkÄ±m ğŸ’š",
    "Ä°yi ki VarsÄ±n",
    "Ä°yi ki Benimlesin",
    "Birlikte SaÄŸlÄ±kla ve Mutlulukla GeÃ§ecek Nice Senelerimiz Olsun ğŸ¤",
    "<span class='signature'>Kaanâ€™dan Ä°clale</span>"
  ];
  let i = 0;

  (function write() {
    if (i >= lines.length) return;
    const d = document.createElement("div");
    d.className = "paper";
    d.innerHTML = lines[i++];
    text.appendChild(d);
    setTimeout(write, 1100);
  })();
}
</script>
